<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-jsonp-library/iron-jsonp-library.html">


<dom-module id="map-element">
    <style>
    :host {
        height:auto;
        width:100%;
    }
    #map {
        height: 100%;
        width: 100%;
    }
    </style>
    <template>
        <iron-jsonp-library library-url="https://maps.googleapis.com/maps/api/js?callback=%%callback%%" notify-event="api-load" library-loaded="{{loaded}}"></iron-jsonp-library>
        <div id="map"></div>
    </template>
</dom-module>

<dom-module id="static-map">
    <template>
    <img src="https://maps.googleapis.com/maps/api/staticmap?zoom={{zoom}}&size={{size}}&maptype={{maptype}}&center={{center}}">
    </template>
</dom-module>

<dom-module id="map-controller">
    <template>
        <map-element maplocation='{{mapcenter}}' mapzoom="{{mapzoom}}"></map-element>
        <static-map center="{{staticcenter}}" size="400x400" zoom="{{staticzoom}}" maptype="roadmap"></static-map>
        <button on-tap="syncroMaps">click</button>
    </template>
</dom-module>

<script>
Polymer({
    is: "map-element",
    properties: {
        maplocation: {
            type: Object,
            notify: true
        },
        mapzoom: {
            type: Number,
            notify: true,
            value: 13
        }
    },
    listeners: {
        'api-load': 'initMap',
    },
    ready: function() {
    },
    initMap: function() {
        var options = {
            zoom: this.mapzoom,
            center: new google.maps.LatLng(this.maplocation)
        };
        var map = new google.maps.Map(
            document.getElementById('map'),
            options);
        map.addListener('center_changed', function(this_){
            return function(){
            this_.maplocation = map.getCenter().toJSON();
        }}(this));
        map.addListener('zoom_changed', function(this_){
            return function(){
            this_.mapzoom = map.getZoom();
        }}(this));
    }
});

Polymer({
    is: "static-map",
    properties:{
        center:{
            type: String,
            notify: true
        },
        zoom:{
            type: Number,
            notify: true
        }
    }
});

Polymer({
    is: "map-controller",
    properties:{
        mapcenter: {
            type: Object
        },
        mapzoom: {
            type: Number,
            value: 13
        }
    },
    syncroMaps: function(e){
        this.staticcenter = this.mapcenter.lat+","+this.mapcenter.lng;
        this.staticzoom = this.mapzoom;
    },
    ready: function(){
        this.staticcenter = this.mapcenter.lat+","+this.mapcenter.lng;
        this.staticzoom = this.mapzoom;
    }
});
</script>